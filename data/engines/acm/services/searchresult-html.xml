<service>
    <resources>
        <item>
            <name>body</name>
            <contentType>text/html</contentType>
        </item>
    </resources>
    <request> <!-- Specifies how to retrieve/access service -->
        <url>
            http://dl.acm.org/results.cfm?h=1&amp;cfid={{{cfid}}}&amp;cftoken={{{cftoken}}}
            <!--
            http://dl.acm.org/results.cfm?within={{query}}&amp;CFID={{cfid}}&amp;CFTOKEN={{cftoken}}&amp;adv=1&amp;COLL=DL&amp;qrycnt=2358153&amp;DL=ACM&amp;Go.x=35&amp;Go.y=3&amp;termzone=all&amp;allofem=&amp;anyofem=&amp;noneofem=&amp;peoplezone=Name&amp;people=&amp;peoplehow=and&amp;keyword=&amp;keywordhow=AND&amp;affil=&amp;affilhow=AND&amp;pubin=&amp;pubinhow=and&amp;pubby=&amp;pubbyhow=OR&amp;since_year=&amp;before_year=&amp;pubashow=OR&amp;sponsor=&amp;sponsorhow=AND&amp;confdate=&amp;confdatehow=OR&amp;confloc=&amp;conflochow=OR&amp;isbnhow=OR&amp;isbn=&amp;doi=&amp;ccs=&amp;subj=
        -->
        </url>
        <method>POST</method> <!-- HTTP Method: GET, POST, etc. -->
        <!-- POST parameters -->
        <body contentType="application/x-www-form-urlencoded">
            <item>
                <name>query</name>
                <value>{{query}}</value>
            </item>
            <item>
                <name>Go.x</name>
                <value>34</value>
            </item>
            <item>
                <name>Go.y</name>
                <value>16</value>
            </item>
        </body>
        <cookies>
            <item>
                <name>CFID</name>
                <value>{{cfid}}</value>
            </item>
            <item>
                <name>CFTOKEN</name>
                <value>{{cftoken}}</value>
            </item>
            <item>
                <name>DEEPCHK</name>
                <value>1</value>
            </item>
            <item>
                <name>__atuvc</name>
                <value>{{atuvc}}</value>
            </item>
        </cookies>
    </request>
    <response from="body">

        <meta>
            <count el="table > tbody > tr > td" expand="true" mode="script">
                <condition mode="script">
                    el.text().trim().match(/Results ([\s\S]*?) of ([\s\S]*?) /) != null
                </condition>
                <value>
                    var count = el.text().trim().match(/Results ([\s\S]*?) of ([\s\S]*?) /)[2]
                    // Remove all "," separators
                    count = count.replace(new RegExp(',', 'g'), '')
                </value>
            </count>
        </meta>

        <articles el="a" expand="true" mode="list">
            <condition mode="script">
                el.attr('href').indexOf('citation.cfm') != -1
            </condition>
            <value>
                <item>
                    <title mode="text" />
                    <url mode="script">el.attr('href').trim()</url>
                    <id mode="script">
                      <!-- get 647583.730422 from id=647583.730422& -->
                      <!-- Note: first item might have id 0 (INFORMS Journal on Computing: Volume 0) -->
                      <![CDATA[
                          el.attr('href').match(/id=([\s\S]*?)&/)[1]
                      ]]>
                    </id>

                    <authors expand="true" mode="text">
                        <el mode="script">
                            // .authors element inside first parent table
                            el.parents().not(':not(table)').first().select('.authors')
                        </el>
                    </authors>
                    
                    <year />

                    <publication expand="true" mode="text">
                        <el mode="script">
                            el.parents().not(':not(table)').first().select('.addinfo strong')
                        </el>
                    </publication>

                </item>
            </value>
        </articles>

    </response>
</service>
